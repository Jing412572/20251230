<!DOCTYPE html>
<html lang="zh-TW">
<head>
<style>
    @import url('https://fonts.googleapis.com/css2?family=ZCOOL+KuaiLe&display=swap');

    body {
        margin: 0;
        padding: 0;
        height: 100vh;
        background-color: #2a2a2a; /* æ¨¡æ“¬éŠæˆ²èƒŒæ™¯ */
        font-family: "Microsoft JhengHei", sans-serif;
    }

    /* å…¨è¢å¹•é®ç½©å®¹å™¨ */
    .victory-screen {
        position: fixed;
        top: 0;
        left: 0;
        width: 100%;
        height: 100%;
        background: rgba(0, 0, 0, 0.7); /* åŠé€æ˜é»‘åº• */
        backdrop-filter: blur(4px);      /* èƒŒæ™¯æ¨¡ç³Š */
        display: flex;
        flex-direction: column;
        justify-content: center;
        align-items: center;
        overflow: hidden; /* é˜²æ­¢æ—‹è½‰èƒŒæ™¯è¶…å‡ºç¯„åœ */
    }

    /* éŠæˆ²çµç®—é¢æ¿ (å¡ç‰‡å¼è¨­è¨ˆ) */
    .victory-panel {
        background: #fff;
        border: 6px solid #000;
        border-radius: 30px;
        padding: 40px 60px;
        display: flex;
        flex-direction: column;
        align-items: center;
        box-shadow: 15px 15px 0px rgba(0,0,0,0.3);
        z-index: 1;
        animation: popIn 0.5s cubic-bezier(0.175, 0.885, 0.32, 1.275);
        position: relative; /* è®“çµ•å°å®šä½çš„å°ç« ä»¥æ­¤ç‚ºåŸºæº– */
    }

    /* åŒ¯å…¥ä¸€å€‹è¼ƒç²—çš„å­—é«”ï¼Œé€™è£¡ä½¿ç”¨ç³»çµ±é è¨­ç²—é«”ç¤ºç¯„ï¼Œå»ºè­°å°‹æ‰¾å¦‚ "Bangers" æˆ–æ—¥ç³»æ¼«ç•«å­—é«” */
    .comic-text {
        /* ä½¿ç”¨ Google Fonts çš„ "ZCOOL KuaiLe" (å¿«æ¨‚é«”)ï¼Œæ›´æœ‰éŠæˆ²æ„Ÿ */
        font-family: "ZCOOL KuaiLe", "Microsoft JhengHei", sans-serif;
        font-weight: 400; /* å¿«æ¨‚é«”æœ¬èº«å°±å¾ˆç²—ï¼Œä¸éœ€é¡å¤–åŠ ç²— */
        font-size: clamp(150px, 25vw, 300px); /* éŸ¿æ‡‰å¼å­—é«”ï¼šå†åŠ å¤§å°ºå¯¸ */
        
        display: inline-block; /* ç¢ºä¿æ¼¸å±¤èˆ‡æ¿¾é¡æ­£ç¢ºå¥—ç”¨ */
        
        /* æ”¹å›ç©©å®šçš„å¯¦è‰²å¡«å……ï¼Œç¢ºä¿æ–‡å­—ä¸€å®šæœƒé¡¯ç¤º */
        color: #FFD700; 
        background: none;
        -webkit-text-stroke: 5px #000;
        text-shadow: 10px 10px 0px #000;
        filter: none;
        
        transform: rotate(-5deg) skew(-5deg);
        
        margin-bottom: 30px;
        animation: title-idle 2s ease-in-out infinite alternate; /* åŠ å…¥å‘¼å¸å‹•ç•« */
    }

    /* æ˜Ÿæ˜Ÿè©•åˆ†ç³»çµ± */
    .star-container {
        display: flex;
        gap: 15px;
        margin-bottom: 25px;
    }

    .star {
        font-size: 80px;
        color: #d1d1d1; /* æœªç²å¾—æ™‚çš„ç°è‰² */
        -webkit-text-stroke: 3px black;
        text-shadow: 4px 4px 0px #000;
        transition: all 0.3s cubic-bezier(0.175, 0.885, 0.32, 1.275);
    }

    .star.active {
        color: #FFD700; /* ç²å¾—æ™‚çš„é‡‘è‰² */
        transform: scale(1.2) rotate(5deg);
    }

    /* è©³ç´°æ•¸æ“šåˆ—è¡¨ */
    .stats-container {
        display: grid;
        grid-template-columns: repeat(3, 1fr);
        gap: 20px;
        width: 100%;
        margin-bottom: 25px;
        border-bottom: 2px dashed #ccc; /* åˆ†éš”ç·š */
        padding-bottom: 20px;
    }

    .stat-item {
        display: flex;
        flex-direction: column;
        align-items: center;
    }

    .stat-label {
        font-size: 24px;
        color: #888;
        font-weight: bold;
        margin-bottom: 5px;
    }

    .stat-value {
        font-size: 40px;
        font-weight: 900;
        color: #333;
    }

    /* ç¶“é©—å€¼æ¢ (XP Bar) - å¢åŠ éŠæˆ²æˆé•·æ„Ÿ */
    .xp-wrapper {
        width: 100%;
        margin-bottom: 20px;
        display: flex;
        align-items: center;
        gap: 10px;
        font-weight: bold;
        position: relative; /* ç‚º Level Up æ–‡å­—å®šä½ */
    }
    .lvl-badge {
        background: #333;
        color: #fff;
        padding: 5px 10px;
        border-radius: 8px;
        font-size: 16px;
        border: 2px solid #000;
    }
    .xp-bar-bg {
        flex-grow: 1;
        height: 20px;
        background: #eee;
        border-radius: 10px;
        border: 3px solid #000;
        overflow: hidden;
        position: relative;
    }
    .xp-bar-fill {
        height: 100%;
        background: linear-gradient(90deg, #2ed573, #7bed9f);
        width: 0%; /* é€é JS æ§åˆ¶å¯¬åº¦å‹•ç•« */
        transition: width 1.5s cubic-bezier(0.22, 1, 0.36, 1);
    }
    .xp-text {
        font-size: 16px;
        color: #2ed573;
        text-shadow: 1px 1px 0 #000;
    }

    /* Level Up ç‰¹æ•ˆæ–‡å­— */
    .level-up-float {
        position: absolute;
        top: -40px;
        left: 50%;
        transform: translateX(-50%);
        font-size: 48px;
        color: #FFD700;
        -webkit-text-stroke: 2px #000;
        text-shadow: 4px 4px 0 #000;
        opacity: 0;
        pointer-events: none;
        z-index: 10;
    }
    .level-up-anim {
        animation: floatUp 1.5s cubic-bezier(0.175, 0.885, 0.32, 1.275) forwards;
    }
    @keyframes floatUp {
        0% { transform: translateX(-50%) scale(0) rotate(-10deg); opacity: 0; }
        20% { transform: translateX(-50%) scale(1.2) rotate(0deg); opacity: 1; }
        80% { transform: translateX(-50%) translateY(-50px) scale(1); opacity: 1; }
        100% { transform: translateX(-50%) translateY(-80px) scale(0.8); opacity: 0; }
    }

    /* è©•åˆ†å°ç«  (Rank Stamp) */
    .rank-stamp {
        position: absolute;
        top: 20px;
        right: 30px;
        font-size: 100px;
        font-weight: 900;
        color: rgba(220, 20, 60, 0.8);
        border: 8px solid rgba(220, 20, 60, 0.8);
        border-radius: 50%;
        width: 140px;
        height: 140px;
        display: flex;
        justify-content: center;
        align-items: center;
        transform: scale(3) rotate(15deg);
        opacity: 0;
        pointer-events: none;
        z-index: 20;
        mix-blend-mode: multiply; /* è®“å°ç« æœ‰è“‹åœ¨ç´™ä¸Šçš„æ„Ÿè¦º */
    }
    .rank-stamp.stamp-anim {
        animation: stamp-slam 0.4s cubic-bezier(0.175, 0.885, 0.32, 1.275) forwards;
    }
    @keyframes stamp-slam {
        0% { transform: scale(3) rotate(15deg); opacity: 0; }
        100% { transform: scale(1) rotate(-15deg); opacity: 1; }
    }

    /* æˆ°åˆ©å“å¯¶ç®± */
    .loot-container {
        margin: 10px 0;
        text-align: center;
        cursor: pointer;
    }
    .chest-icon {
        font-size: 50px;
        transition: transform 0.2s;
        display: inline-block;
    }
    .chest-icon:hover {
        transform: scale(1.2) rotate(-10deg);
    }
    .loot-text {
        font-size: 18px;
        font-weight: bold;
        color: #e67e22;
        min-height: 27px; /* é ç•™é«˜åº¦ */
    }

    /* éŸ³æ•ˆé–‹é—œ */
    .sound-toggle {
        position: absolute;
        top: 20px;
        right: 80px; /* å¾€å·¦ç§»ï¼Œè®“å‡ºä½ç½®çµ¦æš«åœéµ */
        font-size: 30px;
        cursor: pointer;
        z-index: 100;
        filter: drop-shadow(2px 2px 0 #000);
        transition: transform 0.1s;
        user-select: none;
    }
    .sound-toggle:active { transform: scale(0.9); }

    /* æš«åœæŒ‰éˆ• */
    .pause-btn {
        position: absolute;
        top: 20px;
        right: 20px;
        font-size: 30px;
        cursor: pointer;
        z-index: 100;
        filter: drop-shadow(2px 2px 0 #000);
        transition: transform 0.1s;
        user-select: none;
    }
    .pause-btn:active { transform: scale(0.9); }

    /* æš«åœé¸å–®æ¨¡æ…‹è¦–çª— */
    .pause-modal {
        position: fixed;
        top: 0;
        left: 0;
        width: 100%;
        height: 100%;
        background: rgba(0, 0, 0, 0.2); /* é™ä½é®ç½©æ¿ƒåº¦ï¼Œè®“é»‘ç™½ç•«é¢æ›´æ¸…æ™° */
        backdrop-filter: grayscale(100%) contrast(1.5) brightness(1.1); /* é»‘ç™½æ¼«ç•«æ¿¾é¡ï¼šå»è‰² + é«˜å°æ¯” */
        z-index: 300;
        display: none;
        justify-content: center;
        align-items: center;
    }
    .pause-modal.show { display: flex; }

    .pause-panel {
        background: #fff;
        border: 5px solid #000;
        border-radius: 20px;
        padding: 30px;
        width: 280px;
        display: flex;
        flex-direction: column;
        gap: 15px;
        box-shadow: 10px 10px 0 rgba(0,0,0,0.5);
        animation: popIn 0.3s;
        text-align: center;
    }
    .pause-title {
        font-family: "ZCOOL KuaiLe", sans-serif;
        font-size: 45px;
        margin: 0 0 10px 0;
        color: #333;
        -webkit-text-stroke: 2px #000;
    }
    .pause-option {
        padding: 12px;
        font-size: 20px;
        font-weight: bold;
        border: 3px solid #000;
        border-radius: 10px;
        background: #fff;
        cursor: pointer;
        transition: 0.1s;
        font-family: "Microsoft JhengHei", sans-serif;
    }
    .pause-option:hover {
        background: #FFD700;
        transform: translate(-2px, -2px);
        box-shadow: 4px 4px 0 #000;
    }
    .pause-option:active {
        transform: translate(0, 0);
        box-shadow: 0 0 0 #000;
    }
    .btn-quit-game { background: #ff7675; color: #fff; }
    .btn-quit-game:hover { background: #d63031; color: #fff; }

    /* æç¤ºè¨Šæ¯ (Toast) */
    .toast {
        position: fixed;
        bottom: 50px;
        left: 50%;
        transform: translateX(-50%) translateY(100px);
        background: rgba(0, 0, 0, 0.8);
        color: #fff;
        padding: 12px 24px;
        border-radius: 30px;
        font-weight: bold;
        font-size: 16px;
        transition: transform 0.3s cubic-bezier(0.175, 0.885, 0.32, 1.275);
        z-index: 200;
        pointer-events: none;
    }
    .toast.show {
        transform: translateX(-50%) translateY(0);
    }

    .score-row {
        display: flex;
        gap: 40px;
        margin-bottom: 30px;
        /* ç§»é™¤æ—‹è½‰ï¼Œè®“é¢æ¿å…§æ’ç‰ˆæ›´æ•´é½Š */
    }

    .score-text {
        font-family: "Microsoft JhengHei", "Heiti TC", sans-serif;
        font-weight: 900;
        font-size: 60px;
        color: #333; /* æ”¹ç‚ºæ·±è‰²å­—ä»¥é©æ‡‰ç™½åº•é¢æ¿ */
        -webkit-text-stroke: 3px black;
        text-shadow: none; /* é¢æ¿å…§ä¸éœ€è¦å¤ªé‡çš„é™°å½±ï¼Œä¿æŒä¹¾æ·¨ */
    }

    .high-score {
        color: #ff4757; /* æœ€é«˜åˆ†æ”¹ç”¨ç´…è‰²çªé¡¯ */
    }

    .btn-group {
        display: flex;
        gap: 20px;
    }

    /* æ¼«ç•«é¢¨æ ¼æŒ‰éˆ• */
    .btn {
        padding: 15px 40px;
        font-size: 24px;
        font-weight: bold;
        border: 3px solid #000;
        border-radius: 12px;
        cursor: pointer;
        box-shadow: 5px 5px 0px #000;
        transition: transform 0.1s, box-shadow 0.1s;
    }

    .btn:hover {
        transform: scale(1.1) rotate(-2deg); /* æ»‘é¼ æ‡¸åœæ™‚æ”¾å¤§ä¸¦æ­ªæ–œ */
        box-shadow: 8px 8px 0px #000;
    }

    .btn:active {
        transform: translate(3px, 3px);
        box-shadow: 2px 2px 0px #000;
    }

    .btn-retry { background: #fff; color: #000; }
    .btn-next { background: #ff4757; color: #fff; }
    .btn-share { background: #3498db; color: #fff; }

    @keyframes popIn {
        0% { transform: scale(0) rotate(-10deg); opacity: 0; }
        100% { transform: scale(1) rotate(-3deg) skew(-10deg); opacity: 1; }
    }

    /* æ¨™é¡Œå‘¼å¸å‹•ç•« */
    @keyframes title-idle {
        0% { transform: rotate(-3deg) scale(1); }
        100% { transform: rotate(-1deg) scale(1.05); }
    }

    /* æ¼«ç•«æ„Ÿæ—‹è½‰æ”¾å°„èƒŒæ™¯ */
    .sunburst {
        position: absolute;
        top: 50%;
        left: 50%;
        width: 200vmax;
        height: 200vmax;
        background: repeating-conic-gradient(
            from 0deg,
            rgba(255, 255, 255, 0.05) 0deg 15deg,
            transparent 15deg 30deg
        );
        transform: translate(-50%, -50%);
        animation: rotateBg 20s linear infinite;
        z-index: 0;
        pointer-events: none;
    }

    @keyframes rotateBg {
        from { transform: translate(-50%, -50%) rotate(0deg); }
        to { transform: translate(-50%, -50%) rotate(360deg); }
    }

    /* å½©å¸¶ç‰¹æ•ˆæ¨£å¼ */
    .confetti {
        position: absolute;
        width: 15px;
        height: 15px;
        z-index: 2; /* å½©å¸¶åœ¨æœ€ä¸Šå±¤ */
        pointer-events: none;
        animation: fall linear forwards;
    }

    @keyframes fall {
        0% { transform: translateY(-10vh) rotate(0deg); opacity: 1; }
        100% { transform: translateY(110vh) rotate(720deg); opacity: 0; }
    }

    /* æ•…éšœ(Glitch)å‹•ç•«æ•ˆæœ */
    .glitch {
        color: #ff3333 !important; /* å¼·åˆ¶è¦†è“‹åŸæœ¬çš„é»ƒè‰² */
        animation: glitch-anim 0.3s cubic-bezier(0.25, 0.46, 0.45, 0.94) both infinite;
    }

    @keyframes glitch-anim {
        0% {
            text-shadow: 8px 8px 0px #000;
            transform: rotate(-3deg) skew(-10deg) translate(0);
        }
        20% {
            text-shadow: 8px 8px 0px #000, -5px 0 #00ffff;
            transform: rotate(-3deg) skew(-10deg) translate(-5px, 5px);
        }
        40% {
            text-shadow: 8px 8px 0px #000, 5px -5px #ff0000;
            transform: rotate(-3deg) skew(-10deg) translate(5px, -5px);
        }
        60% {
            text-shadow: 8px 8px 0px #000;
            transform: rotate(-3deg) skew(-10deg) translate(0);
        }
        80% {
            text-shadow: 8px 8px 0px #000, 3px 0 #ffff00;
            transform: rotate(-3deg) skew(-10deg) translate(-3px, 0);
        }
        100% {
            text-shadow: 8px 8px 0px #000;
            transform: rotate(-3deg) skew(-10deg) translate(0);
        }

        /* å¤±æ•—ç•«é¢éœ‡å‹•ç‰¹æ•ˆ */
        .shake-effect {
            animation: shake 0.5s cubic-bezier(.36,.07,.19,.97) both;
        }

        @keyframes shake {
            10%, 90% { transform: translate3d(-1px, 0, 0); }
            20%, 80% { transform: translate3d(2px, 0, 0); }
            30%, 50%, 70% { transform: translate3d(-4px, 0, 0); }
            40%, 60% { transform: translate3d(4px, 0, 0); }
        }

        /* å¤±æ•—åŸå› æç¤ºæ¡† */
        .failure-reason {
            font-size: 20px;
            font-weight: bold;
            color: #e74c3c;
            background: rgba(255, 230, 230, 0.8);
            padding: 10px 20px;
            border: 2px dashed #e74c3c;
            border-radius: 10px;
            margin-bottom: 20px;
            text-align: center;
            max-width: 80%;
        }

        @keyframes pulse-red {
            0% { box-shadow: 0 0 0 0 rgba(255, 51, 51, 0.7); }
            70% { box-shadow: 0 0 0 10px rgba(255, 51, 51, 0); }
            100% { box-shadow: 0 0 0 0 rgba(255, 51, 51, 0); }
        }
    }
</style>
</head>
<body>
    <!-- éŸ³æ•ˆé–‹é—œ -->
    <div class="sound-toggle" onclick="toggleSound(this)">ğŸ”Š</div>
    <!-- æš«åœæŒ‰éˆ• -->
    <div class="pause-btn" onclick="togglePause()">â¸</div>

    <div class="victory-screen">
        <div class="sunburst"></div>
        
        <div class="victory-panel">
            <div class="comic-text">æ­å–œé€šé—œ!</div>
            
            <div class="star-container">
                <div class="star">â˜…</div>
                <div class="star">â˜…</div>
                <div class="star">â˜…</div>
            </div>

            <div class="stats-container">
                <div class="stat-item">
                    <span class="stat-label">é€šé—œæ™‚é–“</span>
                    <span class="stat-value">02:45</span>
                </div>
                <div class="stat-item">
                    <span class="stat-label">æœ€å¤§é€£æ“Š</span>
                    <span class="stat-value">x45</span>
                </div>
                <div class="stat-item">
                    <span class="stat-label">æ“Šæ®ºæ•¸</span>
                    <span class="stat-value">128</span>
                </div>
            </div>

            <!-- è©•åˆ†å°ç«  -->
            <div id="rank-stamp" class="rank-stamp">S</div>

            <!-- æ–°å¢ç¶“é©—å€¼æ¢ -->
            <div class="xp-wrapper">
                <div class="level-up-float">LEVEL UP!</div>
                <div class="lvl-badge">LV.15</div>
                <div class="xp-bar-bg">
                    <div class="xp-bar-fill" id="xp-fill"></div>
                </div>
                <div class="xp-text">+850 XP</div>
            </div>

            <!-- æˆ°åˆ©å“å¯¶ç®± -->
            <div class="loot-container" onclick="openChest(this)">
                <div class="chest-icon">ğŸ</div>
                <div class="loot-text">é»æ“Šé–‹å•Ÿå¯¶ç®±</div>
            </div>

            <div class="score-row">
                <div id="score-display" class="score-text">æœ€çµ‚åˆ†æ•¸: 0</div>
                <div class="score-text high-score">æœ€é«˜: 15000</div>
            </div>
            <div class="btn-group">
                <button class="btn btn-retry" onmouseenter="playHoverSound()" onclick="playClickSound(); location.reload()">é‡è©¦</button>
                <button class="btn btn-share" onmouseenter="playHoverSound()" onclick="playClickSound(); shareScore()">åˆ†äº«</button>
                <button class="btn btn-next" onmouseenter="playHoverSound()" onclick="playClickSound(); alert('é€²å…¥ä¸‹ä¸€é—œ...')">ä¸‹ä¸€é—œ</button>
            </div>
        </div>
    </div>

    <!-- æš«åœé¸å–® -->
    <div id="pause-menu" class="pause-modal">
        <div class="pause-panel">
            <div class="pause-title">æš«åœ</div>
            <button class="pause-option" onclick="togglePause()">ç¹¼çºŒéŠæˆ²</button>
            <button class="pause-option btn-quit-game" onclick="window.close(); alert('éŠæˆ²å·²çµæŸ')">çµæŸéŠæˆ²</button>
            <button class="pause-option" onclick="location.reload()">é‡æ–°é–‹å§‹</button>
        </div>
    </div>

    <!-- æç¤ºè¨Šæ¯ -->
    <div id="toast" class="toast">å·²è¤‡è£½æˆ°ç¸¾åˆ°å‰ªè²¼ç°¿ï¼</div>

    <script>
        // è‡ªå‹•ç”¢ç”Ÿæ…¶ç¥å½©å¸¶
        const colors = ['#ff4757', '#2ed573', '#ffa502', '#1e90ff', '#ffffff'];
        const container = document.querySelector('.victory-screen');
        
        for (let i = 0; i < 50; i++) {
            const confetti = document.createElement('div');
            confetti.classList.add('confetti');
            confetti.style.left = Math.random() * 100 + '%';
            confetti.style.top = -Math.random() * 20 + '%'; // å¾ç•«é¢å¤–ä¸Šæ–¹é–‹å§‹
            confetti.style.backgroundColor = colors[Math.floor(Math.random() * colors.length)];
            
            // éš¨æ©Ÿå¤§å°èˆ‡å‹•ç•«æ™‚é–“
            const size = Math.random() * 10 + 8 + 'px';
            confetti.style.width = size;
            confetti.style.height = size;
            confetti.style.animationDuration = (Math.random() * 3 + 2) + 's'; // 2~5ç§’è½åœ°
            confetti.style.animationDelay = (Math.random() * 2) + 's';
            
            container.appendChild(confetti);
        }

        // éŸ³æ•ˆç³»çµ± (Web Audio API) - ç”¢ç”Ÿå¾©å¤éŠæˆ²éŸ³æ•ˆ
        const audioCtx = new (window.AudioContext || window.webkitAudioContext)();
        let isMuted = false;
        let masterVolume = 50; // é è¨­éŸ³é‡ 50%
        
        function playTone(freq, type, duration) {
            if (isMuted) return;
            if (audioCtx.state === 'suspended') audioCtx.resume();
            const osc = audioCtx.createOscillator();
            const gain = audioCtx.createGain();
            osc.type = type; // sine, square, triangle, sawtooth
            osc.frequency.setValueAtTime(freq, audioCtx.currentTime);
            
            // æ ¹æ“š masterVolume è¨ˆç®—éŸ³é‡ (0~100 å°æ‡‰ 0~0.1 çš„ gain)
            const volume = (masterVolume / 100) * 0.1;
            gain.gain.setValueAtTime(volume, audioCtx.currentTime); 
            
            gain.gain.exponentialRampToValueAtTime(0.001, audioCtx.currentTime + duration);
            osc.connect(gain);
            gain.connect(audioCtx.destination);
            osc.start();
            osc.stop(audioCtx.currentTime + duration);
        }

        function playTickSound() { playTone(800, 'square', 0.05); } // åˆ†æ•¸è·³å‹•è²
        function playStarSound() { playTone(1200, 'sine', 0.3); }   // æ˜Ÿæ˜Ÿç²å¾—è²
        function playHoverSound() { playTone(400, 'triangle', 0.1); } // æŒ‰éˆ•æ»‘é
        function playClickSound() { playTone(600, 'square', 0.1); }   // æŒ‰éˆ•é»æ“Š
        function playStampSound() { playTone(150, 'sawtooth', 0.1); } // å°ç« è²
        function playChestSound() { playTone(880, 'sine', 0.2); }     // å¯¶ç®±è²
        function playLevelUpSound() { 
            // å‡ç´šéŸ³æ•ˆï¼šå¿«é€Ÿçš„ä¸Šè¡Œç¶éŸ³
            playTone(523.25, 'square', 0.1); // Do
            setTimeout(() => playTone(659.25, 'square', 0.1), 100); // Mi
            setTimeout(() => playTone(783.99, 'square', 0.1), 200); // Sol
            setTimeout(() => playTone(1046.50, 'square', 0.4), 300); // High Do
        }

        function toggleSound(el) {
            isMuted = !isMuted;
            el.innerText = isMuted ? "ğŸ”‡" : "ğŸ”Š";
            // é»æ“Šæ™‚ç¨å¾®éœ‡å‹•ä¸€ä¸‹
            el.style.transform = "scale(0.8)";
            setTimeout(() => el.style.transform = "scale(1)", 100);
            
            if (!isMuted) playClickSound();
        }

        // æš«åœåŠŸèƒ½
        function togglePause() {
            const modal = document.getElementById('pause-menu');
            if (modal.classList.contains('show')) {
                modal.classList.remove('show');
            } else {
                modal.classList.add('show');
                playClickSound();
            }
        }

        // åˆ†æ•¸æ»¾å‹•å‹•ç•«
        const scoreElement = document.getElementById('score-display');
        const targetScore = 12800; // æœ¬å±€åˆ†æ•¸
        const duration = 2000;     // å‹•ç•«æŒçºŒæ™‚é–“ (æ¯«ç§’)
        let startTime = null;
        let lastSoundTime = 0;

        function animateScore(timestamp) {
            if (!startTime) startTime = timestamp;
            const progress = Math.min((timestamp - startTime) / duration, 1);
            
            // ä½¿ç”¨ Ease Out Cubic ç·©å‹•å‡½æ•¸ï¼šè®“æ•¸å­—ä¸€é–‹å§‹è·‘å¾ˆå¿«ï¼Œæœ€å¾Œæ…¢æ…¢åœä¸‹
            const easeProgress = 1 - Math.pow(1 - progress, 3);
            
            const currentScore = Math.floor(easeProgress * targetScore);
            scoreElement.innerText = `æœ€çµ‚åˆ†æ•¸: ${currentScore}`;
            
            // éŸ³æ•ˆæ§åˆ¶ï¼šæ¯ 80ms è§¸ç™¼ä¸€æ¬¡æ»´ç­”è²ï¼Œé¿å…å¤ªåµ
            if (timestamp - lastSoundTime > 80 && progress < 1) {
                playTickSound();
                lastSoundTime = timestamp;
            }

            if (progress < 1) {
                requestAnimationFrame(animateScore);
            } else {
                // åˆ†æ•¸è·‘å®Œå¾Œï¼Œè“‹ä¸Šè©•åˆ†å°ç« 
                setTimeout(() => {
                    const stamp = document.getElementById('rank-stamp');
                    // æ ¹æ“šåˆ†æ•¸æ±ºå®šç­‰ç´š
                    if (targetScore >= 12000) stamp.innerText = "S";
                    else if (targetScore >= 10000) stamp.innerText = "A";
                    else stamp.innerText = "B";
                    
                    stamp.classList.add('stamp-anim');
                    playStampSound(); // æ’­æ”¾è“‹ç« éŸ³æ•ˆ
                }, 500);
            }
        }

        requestAnimationFrame(animateScore);

        // è™•ç†æœ€é«˜ç´€éŒ„ (LocalStorage) - å³ä½¿é‡æ–°é–‹å§‹ä¹Ÿèƒ½ä¿ç•™
        const highScoreElement = document.querySelector('.high-score');
        let highScore = localStorage.getItem('gameHighScore') || 15000;
        
        if (targetScore > highScore) {
            highScore = targetScore;
            localStorage.setItem('gameHighScore', highScore);
            highScoreElement.innerText = `æœ€é«˜: ${highScore} (æ–°ç´€éŒ„!)`;
            highScoreElement.style.color = "#ff6b81"; // æ–°ç´€éŒ„è®Šè‰²
        } else {
            highScoreElement.innerText = `æœ€é«˜: ${highScore}`;
        }

        // æ˜Ÿæ˜Ÿä¾åºäº®èµ·å‹•ç•«
        const stars = document.querySelectorAll('.star');
        // åªæœ‰åœ¨å‹åˆ©ä¸”åˆ†æ•¸è¶³å¤ æ™‚æ‰é¡¯ç¤ºæ˜Ÿæ˜Ÿ
        if (targetScore > 5000) {
            stars.forEach((star, index) => {
                setTimeout(() => {
                    star.classList.add('active');
                    playStarSound(); // æ’­æ”¾æ˜Ÿæ˜ŸéŸ³æ•ˆ
                }, 500 + (index * 400));
            });
        }

        // XPæ¢å‹•ç•«é‚è¼¯ï¼šæ¨¡æ“¬å‡ç´šéç¨‹
        setTimeout(() => {
            const xpFill = document.getElementById('xp-fill');
            const lvlBadge = document.querySelector('.lvl-badge');
            
            // 1. å…ˆå¡«æ»¿åˆ° 100%
            xpFill.style.width = '100%';
            
            // 2. è§¸ç™¼å‡ç´šç‰¹æ•ˆ (1.5ç§’å¾Œï¼Œç­‰å¾…å¡«æ»¿å‹•ç•«çµæŸ)
            setTimeout(() => {
                playLevelUpSound();
                document.querySelector('.level-up-float').classList.add('level-up-anim');
                lvlBadge.innerText = "LV.16"; // æ›´æ–°ç­‰ç´šæ–‡å­—
                lvlBadge.style.background = "#FFD700"; // ç­‰ç´šæ¡†è®Šé‡‘è‰²
                lvlBadge.style.color = "#000";
                xpFill.style.width = '0%'; // é‡ç½®æ¢
                
                // 3. å¡«å…¥æ–°çš„ç¶“é©—å€¼ (å†é 0.5ç§’)
                setTimeout(() => {
                    xpFill.style.transition = "width 0.5s ease-out"; // åŠ å¿«ç¬¬äºŒæ¬¡å¡«å……é€Ÿåº¦
                    xpFill.style.width = '35%';
                }, 500);
            }, 1500);
        }, 800);

        // å¯¶ç®±é–‹å•Ÿé‚è¼¯
        let isChestOpened = false;
        function openChest(element) {
            if (isChestOpened) return;
            isChestOpened = true;
            
            const icon = element.querySelector('.chest-icon');
            const text = element.querySelector('.loot-text');
            
            playChestSound();
            icon.innerText = "ğŸ’°"; // è®ŠæˆéŒ¢è¢‹æˆ–æ‰“é–‹çš„æ¨£å­
            icon.style.transform = "scale(1.3)";
            
            // éš¨æ©Ÿçå‹µ
            const rewards = ["ç²å¾— 500 é‡‘å¹£!", "ç²å¾—æ–°ç¨±è™Ÿ: é€Ÿé€šç‹", "ç²å¾—é“å…·: å¾©æ´»è—¥æ°´", "ç²å¾— 5 é¡†é‘½çŸ³"];
            const reward = rewards[Math.floor(Math.random() * rewards.length)];
            text.innerText = reward;
            text.style.color = "#27ae60";
        }

        // åˆ†äº«åŠŸèƒ½
        function shareScore() {
            const text = `æˆ‘åœ¨é€™æ¬¾éŠæˆ²ä¸­ç²å¾—äº† ${targetScore} åˆ†ï¼è©•ç´šï¼š${document.getElementById('rank-stamp').innerText}ï¼Œå¿«ä¾†æŒ‘æˆ°æˆ‘å§ï¼`;
            navigator.clipboard.writeText(text).then(() => {
                const toast = document.getElementById('toast');
                toast.classList.add('show');
                setTimeout(() => {
                    toast.classList.remove('show');
                }, 2000);
            });
        }

        // æ¨¡æ“¬ã€ŒéŠæˆ²çµæŸ/é‡æ–°é–‹å§‹ã€ç‹€æ…‹çš„é‚è¼¯
        // å¦‚æœæ˜¯å¤±æ•—ç•«é¢ï¼Œå¯ä»¥å°‡ isVictory è¨­ç‚º false
        const isVictory = true; 

        if (!isVictory) {
            // 1. ä¿®æ”¹æ¨™é¡Œï¼šç´…é»‘é…è‰²ï¼Œè£½é€ å£“è¿«æ„Ÿ
            const title = document.querySelector('.comic-text');
            title.innerText = "éŠæˆ²çµæŸ";
            title.classList.add('glitch'); // åŠ å…¥æ•…éšœå‹•ç•«é¡åˆ¥
            // éŠæˆ²çµæŸæ™‚ç§»é™¤æ¼¸å±¤ï¼Œæ”¹å›ç´”è‰²ä»¥é…åˆæ•…éšœæ•ˆæœ
            title.style.background = "none";
            title.style.color = "#ff3333";
            
            // 2. ä¿®æ”¹èƒŒæ™¯æ”¾å°„ç·šç‚ºç´…è‰²è­¦ç¤ºé¢¨æ ¼
            document.querySelector('.sunburst').style.background = 
                "repeating-conic-gradient(from 0deg, rgba(220, 20, 60, 0.15) 0deg 15deg, transparent 15deg 30deg)";

            // 3. ä¿®æ”¹é¢æ¿é‚Šæ¡†é¡è‰²
            document.querySelector('.victory-panel').style.borderColor = "#8b0000"; // æ·±ç´…é‚Šæ¡†

            // 4. ç§»é™¤æ…¶ç¥å…ƒç´  (æ˜Ÿæ˜Ÿã€ä¸‹ä¸€é—œæŒ‰éˆ•ã€å½©å¸¶)
            document.querySelector('.star-container').style.display = "none"; 
            document.querySelector('.btn-next').style.display = "none";       
            document.querySelector('.xp-wrapper').style.display = "none"; // å¤±æ•—æ™‚éš±è—XPæ¢
            document.querySelector('.loot-container').style.display = "none"; // å¤±æ•—æ™‚éš±è—å¯¶ç®±
            document.getElementById('rank-stamp').style.display = "none";     // å¤±æ•—æ™‚éš±è—è©•åˆ†
            document.querySelectorAll('.confetti').forEach(el => el.remove());

            // 5. åŠ å…¥é¢æ¿éœ‡å‹•æ•ˆæœ (æ¨¡æ“¬æ’æ“Š/å¤±æ•—)
            document.querySelector('.victory-panel').classList.add('shake-effect');

            // 6. éš¨æ©Ÿé¡¯ç¤ºå¤±æ•—åŸå› /æç¤º (å¢åŠ éŠæˆ²è¶£å‘³æ€§)
            const reasons = ["æ­»å› ï¼šè¸©åˆ°äº†é¦™è•‰çš®", "æç¤ºï¼šBOSS æ”¾å¤§æ‹›æ™‚è¨˜å¾—èº²", "æ­»å› ï¼šå¿˜è¨˜è£œè¡€", "æç¤ºï¼šè²ªåˆ€æ˜¯å¤±æ•—çš„ä¸»å› ", "æ­»å› ï¼šè¢«è·¯é‚Šçš„å°æ€ªæ‰“æ­»"];
            const randomReason = reasons[Math.floor(Math.random() * reasons.length)];
            
            const reasonDiv = document.createElement('div');
            reasonDiv.classList.add('failure-reason');
            reasonDiv.innerText = randomReason;
            
            // æ’å…¥åˆ°æŒ‰éˆ•ä¸Šæ–¹
            const btnGroup = document.querySelector('.btn-group');
            btnGroup.parentNode.insertBefore(reasonDiv, btnGroup);

            // 7. è®“é‡è©¦æŒ‰éˆ•æ›´é¡¯çœ¼ (ç´…è‰²å‘¼å¸ç‡ˆæ•ˆæœ)
            const retryBtn = document.querySelector('.btn-retry');
            retryBtn.style.animation = "pulse-red 2s infinite";
            retryBtn.style.borderColor = "#ff3333";
            retryBtn.style.color = "#ff3333";
        }
    </script>
</body>
</html>
